<!doctype html>
<html lang="en" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Auth Portal</title>
  <script src="https://cdn.tailwindcss.com/3.4.17"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&amp;family=DM+Sans:wght@400;500;600&amp;display=swap" rel="stylesheet">
  <style>
    * { font-family: 'DM Sans', sans-serif; }
    h1, h2, h3, .brand { font-family: 'Space Grotesk', sans-serif; }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    @keyframes slideIn {
      from { opacity: 0; transform: translateX(-20px); }
      to { opacity: 1; transform: translateX(0); }
    }
    
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }
    
    .animate-fade-in { animation: fadeIn 0.4s ease-out forwards; }
    .animate-slide-in { animation: slideIn 0.3s ease-out forwards; }
    .animate-pulse { animation: pulse 1.5s ease-in-out infinite; }
    
    .glass-card {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.3);
    }
    
    .input-focus:focus {
      outline: none;
      box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2);
    }
    
    .btn-primary {
      background: linear-gradient(135deg, #6366f1 0%, #4f46e5 100%);
      transition: all 0.2s ease;
    }
    
    .btn-primary:hover {
      transform: translateY(-1px);
      box-shadow: 0 10px 20px -10px rgba(99, 102, 241, 0.5);
    }
    
    .btn-primary:active {
      transform: translateY(0);
    }
    
    .btn-primary:disabled {
      opacity: 0.7;
      cursor: not-allowed;
      transform: none;
    }
  </style>
  <style>body { box-sizing: border-box; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
 </head>
 <body class="h-full overflow-auto" style="background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #334155 100%);">
  <div id="app" class="min-h-full flex items-center justify-center p-4"><!-- Loading State -->
   <div id="loading-view" class="text-center animate-fade-in">
    <div class="w-12 h-12 border-4 border-indigo-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"></div>
    <p class="text-slate-300 text-sm">Checking authentication...</p>
   </div><!-- Auth Forms Container -->
   <div id="auth-container" class="w-full max-w-md hidden"><!-- Login Form -->
    <div id="login-form" class="glass-card rounded-2xl p-8 shadow-2xl animate-fade-in">
     <div class="text-center mb-8">
      <div class="w-16 h-16 bg-gradient-to-br from-indigo-500 to-purple-600 rounded-2xl flex items-center justify-center mx-auto mb-4 shadow-lg">
       <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z" />
       </svg>
      </div>
      <h1 id="login-title" class="brand text-2xl font-bold text-slate-800">Welcome Back</h1>
      <p class="text-slate-500 mt-2 text-sm">Sign in to continue to your account</p>
     </div>
     <form id="login-form-element" class="space-y-5">
      <div><label for="login-email" class="block text-sm font-medium text-slate-700 mb-1.5">Email Address</label> <input type="email" id="login-email" name="email" required class="w-full px-4 py-3 rounded-xl border border-slate-200 input-focus transition-all text-slate-800 placeholder-slate-400" placeholder="you@example.com">
      </div>
      <div><label for="login-password" class="block text-sm font-medium text-slate-700 mb-1.5">Password</label>
       <div class="relative"><input type="password" id="login-password" name="password" required class="w-full px-4 py-3 rounded-xl border border-slate-200 input-focus transition-all text-slate-800 placeholder-slate-400 pr-12" placeholder="••••••••"> <button type="button" onclick="togglePassword('login-password')" class="absolute right-3 top-1/2 -translate-y-1/2 text-slate-400 hover:text-slate-600 transition-colors">
         <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" /> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
         </svg></button>
       </div>
      </div>
      <div id="login-error" class="hidden bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-xl text-sm animate-slide-in">
       <div class="flex items-center gap-2">
        <svg class="w-5 h-5 flex-shrink-0" fill="currentColor" viewbox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd" />
        </svg><span id="login-error-text"></span>
       </div>
      </div><button type="submit" id="login-btn" class="btn-primary w-full py-3.5 rounded-xl text-white font-semibold flex items-center justify-center gap-2"> <span id="login-btn-text">Sign In</span>
       <svg id="login-spinner" class="w-5 h-5 animate-spin hidden" fill="none" viewbox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle> <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z" />
       </svg></button>
     </form>
     <div class="mt-6 text-center">
      <p class="text-slate-500 text-sm">Don't have an account? <button onclick="showRegister()" class="text-indigo-600 font-semibold hover:text-indigo-700 transition-colors">Create one</button></p>
     </div>
    </div><!-- Register Form -->
    <div id="register-form" class="glass-card rounded-2xl p-8 shadow-2xl hidden">
     <div class="text-center mb-8">
      <div class="w-16 h-16 bg-gradient-to-br from-emerald-500 to-teal-600 rounded-2xl flex items-center justify-center mx-auto mb-4 shadow-lg">
       <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z" />
       </svg>
      </div>
      <h1 id="register-title" class="brand text-2xl font-bold text-slate-800">Create Account</h1>
      <p class="text-slate-500 mt-2 text-sm">Join us and start your journey</p>
     </div>
     <form id="register-form-element" class="space-y-5">
      <div><label for="register-name" class="block text-sm font-medium text-slate-700 mb-1.5">Full Name</label> <input type="text" id="register-name" name="name" required class="w-full px-4 py-3 rounded-xl border border-slate-200 input-focus transition-all text-slate-800 placeholder-slate-400" placeholder="John Doe">
      </div>
      <div><label for="register-email" class="block text-sm font-medium text-slate-700 mb-1.5">Email Address</label> <input type="email" id="register-email" name="email" required class="w-full px-4 py-3 rounded-xl border border-slate-200 input-focus transition-all text-slate-800 placeholder-slate-400" placeholder="you@example.com">
      </div>
      <div><label for="register-password" class="block text-sm font-medium text-slate-700 mb-1.5">Password</label>
       <div class="relative"><input type="password" id="register-password" name="password" required minlength="8" class="w-full px-4 py-3 rounded-xl border border-slate-200 input-focus transition-all text-slate-800 placeholder-slate-400 pr-12" placeholder="••••••••"> <button type="button" onclick="togglePassword('register-password')" class="absolute right-3 top-1/2 -translate-y-1/2 text-slate-400 hover:text-slate-600 transition-colors">
         <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" /> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
         </svg></button>
       </div>
       <p class="text-xs text-slate-400 mt-1.5">Must be at least 8 characters</p>
      </div>
      <div id="register-error" class="hidden bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-xl text-sm animate-slide-in">
       <div class="flex items-center gap-2">
        <svg class="w-5 h-5 flex-shrink-0" fill="currentColor" viewbox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd" />
        </svg><span id="register-error-text"></span>
       </div>
      </div>
      <div id="register-success" class="hidden bg-emerald-50 border border-emerald-200 text-emerald-700 px-4 py-3 rounded-xl text-sm animate-slide-in">
       <div class="flex items-center gap-2">
        <svg class="w-5 h-5 flex-shrink-0" fill="currentColor" viewbox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
        </svg><span>Account created successfully! Redirecting to login...</span>
       </div>
      </div><button type="submit" id="register-btn" class="w-full py-3.5 rounded-xl text-white font-semibold flex items-center justify-center gap-2 transition-all" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%);"> <span id="register-btn-text">Create Account</span>
       <svg id="register-spinner" class="w-5 h-5 animate-spin hidden" fill="none" viewbox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle> <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z" />
       </svg></button>
     </form>
     <div class="mt-6 text-center">
      <p class="text-slate-500 text-sm">Already have an account? <button onclick="showLogin()" class="text-indigo-600 font-semibold hover:text-indigo-700 transition-colors">Sign in</button></p>
     </div>
    </div>
   </div><!-- Dashboard (Authenticated State) -->
   <div id="dashboard" class="w-full max-w-2xl hidden">
    <div class="glass-card rounded-2xl p-8 shadow-2xl animate-fade-in">
     <div class="flex items-center justify-between mb-8">
      <div class="flex items-center gap-4">
       <div id="user-avatar" class="w-14 h-14 bg-gradient-to-br from-indigo-500 to-purple-600 rounded-full flex items-center justify-center text-white font-bold text-xl shadow-lg">
        U
       </div>
       <div>
        <h2 id="welcome-text" class="brand text-xl font-bold text-slate-800">Welcome back!</h2>
        <p id="user-email" class="text-slate-500 text-sm">user@example.com</p>
       </div>
      </div><button onclick="logout()" id="logout-btn" class="px-5 py-2.5 rounded-xl border-2 border-slate-200 text-slate-600 font-medium hover:bg-slate-50 hover:border-slate-300 transition-all flex items-center gap-2">
       <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" />
       </svg><span>Logout</span> </button>
     </div>
     <div class="bg-gradient-to-br from-slate-50 to-slate-100 rounded-xl p-6 border border-slate-200">
      <h3 class="brand text-lg font-semibold text-slate-800 mb-4 flex items-center gap-2">
       <svg class="w-5 h-5 text-indigo-500" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
       </svg> User Information</h3>
      <div id="user-info" class="space-y-3">
       <div class="flex items-center justify-between py-2 border-b border-slate-200"><span class="text-slate-500 text-sm">Name</span> <span id="info-name" class="text-slate-800 font-medium">-</span>
       </div>
       <div class="flex items-center justify-between py-2 border-b border-slate-200"><span class="text-slate-500 text-sm">Email</span> <span id="info-email" class="text-slate-800 font-medium">-</span>
       </div>
       <div class="flex items-center justify-between py-2 border-b border-slate-200"><span class="text-slate-500 text-sm">User ID</span> <span id="info-id" class="text-slate-800 font-medium font-mono text-xs">-</span>
       </div>
       <div class="flex items-center justify-between py-2"><span class="text-slate-500 text-sm">Session Status</span> <span class="inline-flex items-center gap-1.5 px-3 py-1 rounded-full bg-emerald-100 text-emerald-700 text-xs font-medium"> <span class="w-2 h-2 bg-emerald-500 rounded-full"></span> Active </span>
       </div>
      </div>
     </div>
     <div class="mt-6 p-4 bg-amber-50 border border-amber-200 rounded-xl">
      <div class="flex items-start gap-3">
       <svg class="w-5 h-5 text-amber-600 flex-shrink-0 mt-0.5" fill="currentColor" viewbox="0 0 20 20"><path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd" />
       </svg>
       <div>
        <p class="text-amber-800 text-sm font-medium">Demo Mode</p>
        <p class="text-amber-700 text-xs mt-1">This is a frontend demo. Connect your API endpoints in the configuration to enable real authentication.</p>
       </div>
      </div>
     </div>
    </div>
   </div>
  </div>
  <script>
    // ============================================
    // Configuration - Update these for your API
    // ============================================
    const API_CONFIG = {
      baseUrl: '', // e.g., 'https://api.yourapp.com'
      endpoints: {
        register: '/auth/register',
        login: '/auth/login',
        me: '/auth/me'
      }
    };

    // Token storage key
    const TOKEN_KEY = 'auth_token';

    // ============================================
    // Default Config for Element SDK
    // ============================================
    const defaultConfig = {
      app_title: 'Auth Portal',
      welcome_message: 'Welcome back!',
      login_button_text: 'Sign In',
      register_button_text: 'Create Account',
      primary_color: '#6366f1',
      secondary_color: '#10b981',
      background_color: '#0f172a',
      text_color: '#1e293b',
      surface_color: '#ffffff'
    };

    let config = { ...defaultConfig };

    // ============================================
    // Element SDK Integration
    // ============================================
    async function initElementSdk() {
      if (window.elementSdk) {
        await window.elementSdk.init({
          defaultConfig,
          onConfigChange: async (newConfig) => {
            config = { ...defaultConfig, ...newConfig };
            applyConfig();
          },
          mapToCapabilities: (cfg) => ({
            recolorables: [
              {
                get: () => cfg.background_color || defaultConfig.background_color,
                set: (v) => { cfg.background_color = v; window.elementSdk.setConfig({ background_color: v }); }
              },
              {
                get: () => cfg.surface_color || defaultConfig.surface_color,
                set: (v) => { cfg.surface_color = v; window.elementSdk.setConfig({ surface_color: v }); }
              },
              {
                get: () => cfg.text_color || defaultConfig.text_color,
                set: (v) => { cfg.text_color = v; window.elementSdk.setConfig({ text_color: v }); }
              },
              {
                get: () => cfg.primary_color || defaultConfig.primary_color,
                set: (v) => { cfg.primary_color = v; window.elementSdk.setConfig({ primary_color: v }); }
              },
              {
                get: () => cfg.secondary_color || defaultConfig.secondary_color,
                set: (v) => { cfg.secondary_color = v; window.elementSdk.setConfig({ secondary_color: v }); }
              }
            ],
            borderables: [],
            fontEditable: undefined,
            fontSizeable: undefined
          }),
          mapToEditPanelValues: (cfg) => new Map([
            ['app_title', cfg.app_title || defaultConfig.app_title],
            ['welcome_message', cfg.welcome_message || defaultConfig.welcome_message],
            ['login_button_text', cfg.login_button_text || defaultConfig.login_button_text],
            ['register_button_text', cfg.register_button_text || defaultConfig.register_button_text]
          ])
        });
      }
    }

    function applyConfig() {
      const bgColor = config.background_color || defaultConfig.background_color;
      const surfaceColor = config.surface_color || defaultConfig.surface_color;
      const textColor = config.text_color || defaultConfig.text_color;
      const primaryColor = config.primary_color || defaultConfig.primary_color;
      const secondaryColor = config.secondary_color || defaultConfig.secondary_color;

      // Background
      document.body.style.background = `linear-gradient(135deg, ${bgColor} 0%, ${adjustColor(bgColor, 20)} 50%, ${adjustColor(bgColor, 40)} 100%)`;

      // Surface cards
      document.querySelectorAll('.glass-card').forEach(card => {
        card.style.backgroundColor = surfaceColor;
      });

      // Text colors
      document.querySelectorAll('#login-title, #register-title, #welcome-text').forEach(el => {
        el.style.color = textColor;
      });

      // Primary button
      const loginBtn = document.getElementById('login-btn');
      if (loginBtn) {
        loginBtn.style.background = `linear-gradient(135deg, ${primaryColor} 0%, ${adjustColor(primaryColor, -20)} 100%)`;
      }

      // Secondary button (register)
      const registerBtn = document.getElementById('register-btn');
      if (registerBtn) {
        registerBtn.style.background = `linear-gradient(135deg, ${secondaryColor} 0%, ${adjustColor(secondaryColor, -20)} 100%)`;
      }

      // Text content
      document.getElementById('login-btn-text').textContent = config.login_button_text || defaultConfig.login_button_text;
      document.getElementById('register-btn-text').textContent = config.register_button_text || defaultConfig.register_button_text;
      document.getElementById('welcome-text').textContent = config.welcome_message || defaultConfig.welcome_message;
      
      const loginTitle = document.getElementById('login-title');
      if (loginTitle && config.app_title) {
        loginTitle.textContent = config.app_title;
      }
    }

    function adjustColor(hex, amount) {
      const num = parseInt(hex.replace('#', ''), 16);
      const r = Math.min(255, Math.max(0, (num >> 16) + amount));
      const g = Math.min(255, Math.max(0, ((num >> 8) & 0x00FF) + amount));
      const b = Math.min(255, Math.max(0, (num & 0x0000FF) + amount));
      return '#' + (0x1000000 + r * 0x10000 + g * 0x100 + b).toString(16).slice(1);
    }

    // ============================================
    // Auth State Management
    // ============================================
    function getToken() {
      return localStorage.getItem(TOKEN_KEY);
    }

    function setToken(token) {
      localStorage.setItem(TOKEN_KEY, token);
    }

    function removeToken() {
      localStorage.removeItem(TOKEN_KEY);
    }

    // ============================================
    // API Functions
    // ============================================
    async function apiRequest(endpoint, options = {}) {
      const url = API_CONFIG.baseUrl + endpoint;
      const token = getToken();
      
      const headers = {
        'Content-Type': 'application/json',
        ...(token && { 'Authorization': `Bearer ${token}` }),
        ...options.headers
      };

      try {
        const response = await fetch(url, {
          ...options,
          headers
        });

        const data = await response.json().catch(() => ({}));

        if (!response.ok) {
          throw new Error(data.message || data.error || `Request failed with status ${response.status}`);
        }

        return { success: true, data };
      } catch (error) {
        return { success: false, error: error.message };
      }
    }

    async function register(name, email, password) {
      return apiRequest(API_CONFIG.endpoints.register, {
        method: 'POST',
        body: JSON.stringify({ name, email, password })
      });
    }

    async function login(email, password) {
      return apiRequest(API_CONFIG.endpoints.login, {
        method: 'POST',
        body: JSON.stringify({ email, password })
      });
    }

    async function getMe() {
      return apiRequest(API_CONFIG.endpoints.me, {
        method: 'GET'
      });
    }

    // ============================================
    // UI Functions
    // ============================================
    function showLoading() {
      document.getElementById('loading-view').classList.remove('hidden');
      document.getElementById('auth-container').classList.add('hidden');
      document.getElementById('dashboard').classList.add('hidden');
    }

    function showAuth() {
      document.getElementById('loading-view').classList.add('hidden');
      document.getElementById('auth-container').classList.remove('hidden');
      document.getElementById('dashboard').classList.add('hidden');
    }

    function showDashboard(user) {
      document.getElementById('loading-view').classList.add('hidden');
      document.getElementById('auth-container').classList.add('hidden');
      document.getElementById('dashboard').classList.remove('hidden');

      // Update user info
      const avatar = document.getElementById('user-avatar');
      const initial = (user.name || user.email || 'U').charAt(0).toUpperCase();
      avatar.textContent = initial;

      document.getElementById('user-email').textContent = user.email || '-';
      document.getElementById('info-name').textContent = user.name || '-';
      document.getElementById('info-email').textContent = user.email || '-';
      document.getElementById('info-id').textContent = user.id || user._id || '-';
    }

    function showLogin() {
      document.getElementById('login-form').classList.remove('hidden');
      document.getElementById('register-form').classList.add('hidden');
      clearErrors();
    }

    function showRegister() {
      document.getElementById('login-form').classList.add('hidden');
      document.getElementById('register-form').classList.remove('hidden');
      document.getElementById('register-form').classList.add('animate-fade-in');
      clearErrors();
    }

    function clearErrors() {
      document.getElementById('login-error').classList.add('hidden');
      document.getElementById('register-error').classList.add('hidden');
      document.getElementById('register-success').classList.add('hidden');
    }

    function showLoginError(message) {
      const errorEl = document.getElementById('login-error');
      document.getElementById('login-error-text').textContent = message;
      errorEl.classList.remove('hidden');
    }

    function showRegisterError(message) {
      const errorEl = document.getElementById('register-error');
      document.getElementById('register-error-text').textContent = message;
      errorEl.classList.remove('hidden');
    }

    function showRegisterSuccess() {
      document.getElementById('register-success').classList.remove('hidden');
    }

    function togglePassword(inputId) {
      const input = document.getElementById(inputId);
      input.type = input.type === 'password' ? 'text' : 'password';
    }

    function setButtonLoading(btnId, spinnerId, loading) {
      const btn = document.getElementById(btnId);
      const spinner = document.getElementById(spinnerId);
      
      btn.disabled = loading;
      spinner.classList.toggle('hidden', !loading);
    }

    // ============================================
    // Event Handlers
    // ============================================
    async function handleLogin(e) {
      e.preventDefault();
      clearErrors();

      const email = document.getElementById('login-email').value;
      const password = document.getElementById('login-password').value;

      setButtonLoading('login-btn', 'login-spinner', true);

      // Demo mode check
      if (!API_CONFIG.baseUrl) {
        await new Promise(r => setTimeout(r, 1000));
        setToken('demo_token');
        showDashboard({ name: 'Demo User', email: email, id: 'demo_123' });
        setButtonLoading('login-btn', 'login-spinner', false);
        return;
      }

      const result = await login(email, password);

      setButtonLoading('login-btn', 'login-spinner', false);

      if (result.success) {
        const token = result.data.token || result.data.accessToken;
        if (token) {
          setToken(token);
        }
        await checkAuth();
      } else {
        showLoginError(result.error || 'Login failed. Please try again.');
      }
    }

    async function handleRegister(e) {
      e.preventDefault();
      clearErrors();

      const name = document.getElementById('register-name').value;
      const email = document.getElementById('register-email').value;
      const password = document.getElementById('register-password').value;

      setButtonLoading('register-btn', 'register-spinner', true);

      // Demo mode check
      if (!API_CONFIG.baseUrl) {
        await new Promise(r => setTimeout(r, 1000));
        showRegisterSuccess();
        setButtonLoading('register-btn', 'register-spinner', false);
        setTimeout(() => {
          showLogin();
          document.getElementById('login-email').value = email;
        }, 2000);
        return;
      }

      const result = await register(name, email, password);

      setButtonLoading('register-btn', 'register-spinner', false);

      if (result.success) {
        showRegisterSuccess();
        setTimeout(() => {
          showLogin();
          document.getElementById('login-email').value = email;
        }, 2000);
      } else {
        showRegisterError(result.error || 'Registration failed. Please try again.');
      }
    }

    async function logout() {
      removeToken();
      showAuth();
      showLogin();
      
      // Clear form fields
      document.getElementById('login-email').value = '';
      document.getElementById('login-password').value = '';
    }

    // ============================================
    // Session Persistence
    // ============================================
    async function checkAuth() {
      const token = getToken();

      if (!token) {
        showAuth();
        return;
      }

      // Demo mode
      if (!API_CONFIG.baseUrl || token === 'demo_token') {
        showDashboard({ name: 'Demo User', email: 'demo@example.com', id: 'demo_123' });
        return;
      }

      showLoading();

      const result = await getMe();

      if (result.success && result.data) {
        const user = result.data.user || result.data;
        showDashboard(user);
      } else {
        removeToken();
        showAuth();
      }
    }

    // ============================================
    // Initialize
    // ============================================
    async function init() {
      // Initialize Element SDK
      await initElementSdk();
      applyConfig();

      // Set up form handlers
      document.getElementById('login-form-element').addEventListener('submit', handleLogin);
      document.getElementById('register-form-element').addEventListener('submit', handleRegister);

      // Check existing session
      await checkAuth();
    }

    init();
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9cda8523c4777edf',t:'MTc3MTA1MDY2MC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>